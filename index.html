<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>DeFi Rates</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 16px; }
      .card { padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-top: 12px; }
      pre { white-space: pre-wrap; word-break: break-word; background: #111; color: #0f0; padding: 12px; border-radius: 10px; overflow:auto; }
    </style>
  </head>
  <body>
    <h1>DeFi Rate Tracker</h1>
    <div class="card">
      <div id="status">Loading…</div>
      <div id="hint" style="opacity:.7;margin-top:6px;"></div>
    </div>
    <div class="card">
      <h3>latest.json</h3>
      <pre id="out">(waiting)</pre>
    </div>

    <script>
      (async () => {
        const status = document.getElementById("status");
        const out = document.getElementById("out");
        const hint = document.getElementById("hint");

        try {
          // IMPORTANT: works for GitHub Pages project sites too
          const url = new URL("./data/latest.json", window.location.href);
          hint.textContent = "Fetching: " + url.toString();

          const res = await fetch(url.toString(), { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status} - ${res.statusText}`);

          const data = await res.json();
          status.textContent = "Loaded ✅";
          out.textContent = JSON.stringify(data, null, 2);
        } catch (e) {
          status.textContent = "Failed ❌ (see error below)";
          out.textContent = (e && e.stack) ? e.stack : String(e);
          console.error(e);
        }
      })();
    </script>
  </body>
</html>
